{% extends 'base.html' %}
{% load static %}

{% block content %}
<section id="cart-hero" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 40vh; display: flex; align-items: center; justify-content: center; text-align: center; color: white; padding: 40px 20px;">
    <div class="texts">
        <h1 style="font-size: 3rem; margin-bottom: 20px; font-family: 'Montserrat', sans-serif; font-weight: 300;">Shopping Cart</h1>
        <p style="font-size: 1.2rem; margin-bottom: 30px;">Review your items and proceed to checkout</p>
    </div>
</section>

<section id="cart-content" class="section-p1" style="background: #f8f9fa; padding: 60px 20px;">
    <div style="max-width: 1200px; margin: 0 auto;">
        {% if cart_items %}
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 40px;">
            <!-- Cart Items -->
            <div class="cart-items">
                <h2 style="margin-bottom: 30px; color: #333; font-size: 1.8rem;">Your Items</h2>
                <div class="cart-items-list">
                    {% for item in cart_items %}
                    <div class="cart-item" style="background: white; border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); display: flex; align-items: center; gap: 20px;">
                        <!-- Product Image -->
                        <div class="item-image" style="flex-shrink: 0;">
                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" style="width: 120px; height: 120px; object-fit: cover; border-radius: 10px;">
                        </div>
                        
                        <!-- Product Details -->
                        <div class="item-details" style="flex: 1;">
                            <h3 style="margin-bottom: 10px; color: #333; font-size: 1.3rem;">{{ item.product.name }}</h3>
                            <p style="color: #666; margin-bottom: 10px;">{{ item.product.category }}</p>
                            <p style="color: #333; font-weight: 600; font-size: 1.1rem;">${{ item.product.price }} each</p>
                        </div>
                        
                        <!-- Quantity Controls -->
                        <div class="quantity-controls" style="display: flex; align-items: center; gap: 15px;">
                            <button class="quantity-btn" onclick="updateQuantity({{ item.id }}, {{ item.quantity|add:'-1' }})" style="background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem; color: #666;">-</button>
                            <span class="quantity" style="font-size: 1.2rem; font-weight: 600; min-width: 30px; text-align: center;">{{ item.quantity }}</span>
                            <button class="quantity-btn" onclick="updateQuantity({{ item.id }}, {{ item.quantity|add:'1' }})" style="background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem; color: #666;">+</button>
                        </div>
                        
                        <!-- Item Total -->
                        <div class="item-total" style="text-align: right; min-width: 120px;">
                            <p style="font-size: 1.3rem; font-weight: 700; color: #333; margin-bottom: 5px;">${{ item.total_price }}</p>
                            <button class="remove-btn" onclick="removeItem({{ item.id }})" style="background: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 20px; font-size: 0.9rem; cursor: pointer;">Remove</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Cart Summary -->
            <div class="cart-summary" style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); height: fit-content;">
                <h3 style="margin-bottom: 25px; color: #333; font-size: 1.5rem;">Order Summary</h3>
                
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: #666;">Items ({{ cart.total_items }})</span>
                        <span style="color: #333; font-weight: 600;">${{ cart.total_price }}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: #666;">Shipping</span>
                        <span style="color: #333; font-weight: 600;">Free</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: #666;">Tax</span>
                        <span style="color: #333; font-weight: 600;">$0.00</span>
                    </div>
                </div>
                
                <hr style="margin: 20px 0; border: none; border-top: 2px solid #e9ecef;">
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                    <span style="font-size: 1.3rem; font-weight: 700; color: #333;">Total</span>
                    <span style="font-size: 1.5rem; font-weight: 700; color: #667eea;">${{ cart.total_price }}</span>
                </div>
                
                <a href="{% url 'checkout' %}" class="checkout-btn" style="width: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: block; text-align: center;">
                    Proceed to Checkout
                </a>
                
                <div style="margin-top: 20px; text-align: center;">
                    <a href="{% url 'collection_carousel' %}" style="color: #667eea; text-decoration: none; font-weight: 500;">Continue Shopping</a>
                </div>
            </div>
        </div>
        {% else %}
        <!-- Empty Cart -->
        <div style="text-align: center; padding: 80px 20px;">
            <div style="background: white; border-radius: 20px; padding: 60px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 500px; margin: 0 auto;">
                <div style="font-size: 4rem; margin-bottom: 30px; color: #667eea;">
                    <span class="material-symbols-outlined">shopping_cart</span>
                </div>
                <h2 style="margin-bottom: 20px; color: #333; font-size: 2rem;">Your cart is empty</h2>
                <p style="color: #666; margin-bottom: 30px; font-size: 1.1rem;">Looks like you haven't added any items to your cart yet.</p>
                <a href="{% url 'collection_carousel' %}" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; border-radius: 30px; text-decoration: none; font-weight: 600; display: inline-block;">
                    Start Shopping
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<style>
.quantity-btn:hover {
    background: #667eea !important;
    color: white !important;
    border-color: #667eea !important;
}

.remove-btn:hover {
    background: #c0392b !important;
}

.checkout-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
}

@media (max-width: 768px) {
    #cart-content > div {
        grid-template-columns: 1fr !important;
        gap: 30px !important;
    }
    
    .cart-item {
        flex-direction: column !important;
        text-align: center !important;
    }
    
    .item-image img {
        width: 150px !important;
        height: 150px !important;
    }
    
    .quantity-controls {
        justify-content: center !important;
    }
}
</style>

<script>
function updateQuantity(itemId, newQuantity) {
    if (newQuantity < 0) return;
    
        fetch('{% url "update_cart_item" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content')
            },
        body: JSON.stringify({
            'item_id': itemId,
            'quantity': newQuantity
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Reload page to update totals
            location.reload();
        } else {
            showNotification(data.message, 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('Error updating cart', 'error');
    });
}

function removeItem(itemId) {
    if (confirm('Are you sure you want to remove this item from your cart?')) {
        fetch('{% url "remove_from_cart" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('meta[name="csrf-token"]')?.getAttribute('content')
            },
            body: JSON.stringify({
                'item_id': itemId
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Item removed from cart', 'success');
                // Reload page to update totals
                location.reload();
            } else {
                showNotification(data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error removing item', 'error');
        });
    }
}

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#4CAF50' : '#f44336'};
        color: white;
        padding: 15px 20px;
        border-radius: 5px;
        z-index: 1000;
        font-weight: 500;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    `;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}
</script>
{% endblock %}